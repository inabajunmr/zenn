---
title: "RFC6749 ã® 10.6.  Authorization Code Redirection URI Manipulation ã«ã¤ã„ã¦"
emoji: "ğŸ’‹"
type: "tech"
topics: ["oauth2"]
published: true
---

[RFC6749ï¼ˆThe OAuth 2.0 Authorization Frameworkï¼‰](https://datatracker.ietf.org/doc/html/rfc6749)ã®[10.6. Authorization Code Redirection URI Manipulation](https://datatracker.ietf.org/doc/html/rfc6749#section-10.6)ã«ã¤ã„ã¦æ•´ç†ã—ã¾ã—ãŸã€‚

# èªå¯ã‚³ãƒ¼ãƒ‰ãƒ•ãƒ­ãƒ¼
![](https://storage.googleapis.com/zenn-user-upload/f88a21aa68368b224ace4d19.png)
<!-- ![](http://www.plantuml.com/plantuml/png/SoWkIImgAStDuKfCBiaiIon9LGXrv0frLD2rKtZSjFvnyyh7JKiUDorwtBpvSNC7N14skQBKajAYFAZU5wjwd_QlVzoqzN7pdiVD4u2a5KoiUHL8SzEAnqqxWTfYyjxlwIXAJSaiIaqkYIyjohJDA2afABRIrq_EoKpDAz5BhKZCBSX9rKlEpts_fnFX0amRe2x0wNg42zQ0xPuB50Ooy7eAKmYNxu1IG1giVZEQ7ubmD8noICrB0SO60000) -->

èªå¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§æŒ‡å®šã—ãŸ redirect_uri ã«èªå¯ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒè¿”ã£ã¦ãã‚‹ã€‚ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¯èªå¯ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«å«ã¾ã‚Œã‚‹èªå¯ã‚³ãƒ¼ãƒ‰ã‚’ä½¿ã£ã¦ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—ã™ã‚‹ã€‚

## 10.6. Authorization Code Redirection URI Manipulation 

å¼•ç”¨ã¯ã™ã¹ã¦ [10.6. Authorization Code Redirection URI Manipulation](https://datatracker.ietf.org/doc/html/rfc6749#section-10.6) ã®ã‚‚ã®ã¨ãªã‚Šã¾ã™ã€‚

### æ”»æ’ƒã®è©³ç´°

> An attacker can create an account at a legitimate client and initiate the authorization flow. When the attacker's user-agent is sent to the authorization server to grant access, the attacker grabs the authorization URI provided by the legitimate client and replaces the client's redirection URI with a URI under the control of the attacker.

![](http://www.plantuml.com/plantuml/png/SoWkIImgAStDuKfCBiaiIon9LNWsPVUpISql6beVDwuBTUH2vIhesYayRbh_k7dbuwObZviMFMxU_BYv0wuPcrnHQabfKPx2YrMzJ_k1agj0IffMF6xQ2PG4cgaG6kG9r3RfQV-qf_kcSpcavgK0dGC0)

æ”»æ’ƒè€…ã¯ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆã™ã‚‹ã€‚èªå¯ãƒ•ãƒ­ãƒ¼ã‚’é–‹å§‹ã—ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒç”Ÿæˆã—ãŸèªå¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆã® URI ã‚’å–å¾—ã™ã‚‹ã€‚æ”»æ’ƒè€…ã¯å–å¾—ã—ãŸèªå¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ URI ã‚’è‡ªèº«ã®ç®¡ç†ã™ã‚‹ URI ã¨å…¥ã‚Œæ›¿ãˆãŸèªå¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ä½œæˆã™ã‚‹ã€‚

> The attacker then tricks the victim into following the manipulated link to authorize access to the legitimate client.

> Once at the authorization server, the victim is prompted with a normal, valid request on behalf of a legitimate and trusted client, and authorizes the request. The victim is then redirected to an endpoint under the control of the attacker with the authorization code.

![](https://storage.googleapis.com/zenn-user-upload/bdf0b51e13225eb1c61057aa.png)

<!--![](http://www.plantuml.com/plantuml/png/SoWkIImgAStDuKfCBiaiIon9LNYnQFNJTPjVDBG-RbmNwiY5obNGjLDuiQhtQV_wnqrR7pVlUTmy0KXQAJoRillPf6Q8gYTxvpphcF2uSVhZnlbGjSsh7ZS1TQnutBJpSND7JDxxFHr5gIcPHQd99V6bHPcs6IKb1SLM-lgfPPavUgaLYRa5EQbwoVcvx_Tq8Xo6QIzNKMf9QL4UfXjHt0Eojtdpu-REnyrp7pSj0RCxh636DQy1EsekK1Z8WDj6s0GkXzIy56380G00) -->

æ”»æ’ƒè€…ã¯ä½œæˆã—ãŸ URI ã‚’è¢«å®³è€…ã«è¸ã¾ã›ã‚‹ã€‚ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ URI ãŒå…¥ã‚Œæ›¿ãˆã‚‰ã‚Œã¦ã„ã‚‹ã®ã§èªå¯ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒèªå¯ã‚³ãƒ¼ãƒ‰ã¨ã¨ã‚‚ã«æ”»æ’ƒè€…ã® URI ã«é€ä¿¡ã•ã‚Œã‚‹ã€‚

> The attacker completes the authorization flow by sending the authorization code to the client using the original redirection URI provided by the client. The client exchanges the authorization code with an access token and links it to the attacker's client account, which can now gain access to the protected resources authorized by the victim (via the client).

![](https://storage.googleapis.com/zenn-user-upload/985ee4ccff510fe9883139a5.png)

<!-- ![](http://www.plantuml.com/plantuml/png/SoWkIImgAStDuKfCBiaiIon9LNWsPVUpISql6beVDwuBTUH2vIhesYayRbh_k7dbuwObZviMFMxU_BYvmqhXnQhUf_r0uJMFctO-RfuB50OoOlBUx-b8paz9jNsnQFNJTPl1Xgn-lcN2uyQbZnlxeNgQW2RiUTpS-NvF9y8Hc7PmOGg170CpP2lOa0b0qae1A0MaWUh1obQ164qhm0xhGDY0gP6hABMaj2WFJJkcZv0yimxe5h3nku6IoFg0de4Qn-MGcfS23600) -->

æ”»æ’ƒè€…ã¯æ”»æ’ƒè€…ã®ç®¡ç†ã™ã‚‹ URI ã«é€ä¿¡ã•ã‚ŒãŸè¢«å®³è€…ã«ç´ã¥ãèªå¯ã‚³ãƒ¼ãƒ‰ã‚’ã€èªå¯ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¨ã—ã¦ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«é€ä¿¡ã™ã‚‹ã€‚ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¯èªå¯ã‚³ãƒ¼ãƒ‰ã‚’ä½¿ã£ã¦ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—ã™ã‚‹ãŒã€ã“ã®ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã¯è¢«å®³è€…ã®ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã¨ãªã‚‹ã€‚

![](https://storage.googleapis.com/zenn-user-upload/58cff54fa7ea95c1bd28f2d6.png)

<!-- ![](http://www.plantuml.com/plantuml/png/SoWkIImgAStDuKfCBiaiIon9LNWsPVUpISql6beVDwuBTUH2vIhesYayRbh_k7dbuwObZviMFMxU_BYvmqhXoTwfZviw7pTs0rKzczpxPEySX86OwhamXS06DwzwtBJtSVEUnqqx7pTj1J6Q9m19AuKNYrO_NRSPuWYW5f3sfjr0LK2DOENhGOOqJNgoT__ZniMF6-UZEG6doLn5gIMbHNamoY4rBmKO5W00) -->

ã“ã®æ™‚ç‚¹ã§ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¯æ”»æ’ƒè€…ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¨è¢«å®³è€…ã®ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç´ä»˜ã‘ã‚‹ãŸã‚ã€æ”»æ’ƒè€…ã®æ“ä½œã«ã‚ˆã£ã¦ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒãƒªã‚½ãƒ¼ã‚¹ã‚µãƒ¼ãƒãƒ¼ã«ä½•ã‹ã‚’æ“ä½œã™ã‚‹ã¨ã€é–“æ¥çš„ã«æ”»æ’ƒè€…ãŒè¢«å®³è€…ã®ãƒªã‚½ãƒ¼ã‚¹ã‚’æ“ä½œã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚ä¾‹ãˆã°ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒãƒªã‚½ãƒ¼ã‚¹ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰å€‹äººæƒ…å ±ã‚’å–å¾—ã—ã¦ç”»é¢ã«è¡¨ç¤ºã—ãŸå ´åˆã€æ”»æ’ƒè€…ã¯è¢«å®³è€…ã®å€‹äººæƒ…å ±ã‚’å‚ç…§ã§ãã‚‹ã€‚

### å¯¾ç­–ã«ã¤ã„ã¦

> In order to prevent such an attack, the authorization server MUST ensure that the redirection URI used to obtain the authorization code is identical to the redirection URI provided when exchanging the authorization code for an access token. The authorization server MUST require public clients and SHOULD require confidential clients to register their redirection URIs. If a redirection URI is provided in the request, the authorization server MUST validate it against the registered value.

#### èªå¯ã‚µãƒ¼ãƒãƒ¼ã¯èªå¯ã‚³ãƒ¼ãƒ‰ã‚’å¾—ã‚‹ã®ã«åˆ©ç”¨ã—ãŸãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ URI ã¨èªå¯ã‚³ãƒ¼ãƒ‰ã¨ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å¼•ãæ›ãˆã‚‹éš›ã«æ¸¡ã™ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ URI ãŒåŒã˜ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèªã—ãªã‘ã‚Œã°ãªã‚‰ãªã„
![](https://storage.googleapis.com/zenn-user-upload/2881ea52d4fd58c89131689a.png)
<!-- ![](http://www.plantuml.com/plantuml/png/SoWkIImgAStDuKfCBiaiIon9LGXrv0frLD2rKtYnglTf__h7JLiVD-zvt3m1I5efF9ko-zcavXSDhOyRrptPE-TPnuJ7ZTCVDyw7gcrUzRW9g6F5uwQTZvixOlBUx-aeIat9B4fDBealBSgqpIWfAIYsqjTFBSlCqKkjICmjo4dLIyxFVR-d4-40J7kvYb9BIelo8Ev2SSFpTGkVJsXxt3ZpSLFtu-PP81rDEwnWHZIl0JjaxkFcpK06t0R29d0vfEQb04C50000) -->

![](https://storage.googleapis.com/zenn-user-upload/88b54c1035df8cc1ac1eed71.png)

<!-- ![](http://www.plantuml.com/plantuml/png/PP31IiD0443l-Ohz0Tjxe58_mfiWOJDW84dBTY8UpGv2Uf0MyQf2KT1Mwg5w4FCtGsjk_GLdbuhKN9QPsPatZ-cFC39OP6aGQKpE8mIrkVtQt51pUSNbylWes4_LmQ5Y-yRqmlQHxOnfnLI5gfbVhoTIVcNxoNGdPGbEycrTwK4ClMQsM2zN7hBuVfzo-SJbP3TZXL0pZRVr-4-YlIDebvpCB-J3GwRoXag-NERwfMtk0llinIglP21E36WyBKpIEqCSZi9kLwS9vDY1YoWRfj3HWsnFgBqdC825oPMmdHVL_yXA3iRquFVUCn5JASJTLD27F9Qp_m00) -->

ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¯ redirect_uri ãŒæ”»æ’ƒè€…ã® URI ã«ãªã‚‹ã“ã¨ã‚’æƒ³å®šã—ã¦ã„ãªã„ãŸã‚ã€ãƒˆãƒ¼ã‚¯ãƒ³ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ redirect_uri ãŒãƒŸã‚¹ãƒãƒƒãƒã¨ãªã‚‹ã€‚

#### èªå¯ã‚µãƒ¼ãƒãƒ¼ã¸ã®ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ URI ã®ç™»éŒ²ã‚’å¿…é ˆã¨ã—ã€ã‚³ãƒ³ãƒ•ã‚£ãƒ‡ãƒ³ã‚·ãƒ£ãƒ«ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ URI ã®ç™»éŒ²ã‚’æ¨å¥¨ã™ã‚‹ã€‚ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ URI ãŒã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰æä¾›ã•ã‚ŒãŸå ´åˆã€èªå¯ã‚µãƒ¼ãƒãƒ¼ã¯äº‹å‰ã«ç™»éŒ²ã•ã‚ŒãŸå€¤ã§ãã® URI ã‚’æ¤œè¨¼ã—ãªã‘ã‚Œã°ãªã‚‰ãªã„

![](https://storage.googleapis.com/zenn-user-upload/63e87bac12d1fb1c161af6b6.png)

<!-- ![](http://www.plantuml.com/plantuml/png/SoWkIImgAStDuKfCBiaiIon9LGXrv0frLD2rKtYnglTf__h7JLiVD-zvt3m1I5efF9ko-zcavXSDhOyRrptPE-TPnuJ7ZTCVDyw7gcrUzRW9g6F5uwQTZvixOlBUx-aeIat9B4fDBealBSgqpIWfAIYsqjTFBSlCqKkjICmjo4dLIyxFVR-d4-40J7kvYb9BIelo540cDwy42g2Pg_2uiUTnyxp7pSsFcnl13bhrkB45PAX3QbuAq7S0) -->

æ”»æ’ƒè€…ãŒ redirect_uri ã‚’å…¥ã‚Œæ›¿ãˆãŸèªå¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’èªå¯ã‚µãƒ¼ãƒãƒ¼ãŒå—ã‘å…¥ã‚Œãªã„ã€‚
